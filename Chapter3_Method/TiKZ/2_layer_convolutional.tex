\begin{figure}
    \centering
   \begin{tikzpicture}[scale=1.5,every node/.style={minimum size=1cm},on grid]
    % slanting: production of a set of n 'laminae' to be piled up.
    % N=number of grids.

        \begin{scope}[
            yshift=-200,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = red, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \draw[black, very thick] (0,0) rectangle (2.1, 2.7); % marking borders 

            \coordinate (s9) at (0, 0);
            %\node at (s9) [fill=blue, circle, scale=0.5] {$s$};
            \coordinate (s10) at (0, 2.7);
            %\node at (s10) [fill=pink, circle, scale=0.5] {$s$};
            \coordinate (s11) at (2.1, 0);
            %\node at (s11) [fill=yellow, circle, scale=0.5] {$s$};
            \coordinate (s12) at (2.1, 2.7);
            %\node at (s12) [fill=cyan, circle, scale=0.5] {$s$};
            \coordinate (h_re) at (0, 2.7);
            %\node at (h_re) [fill=red, circle, scale=0.5] {$s$};
                                   
            % begynner i punkt (x, y) rectangle (x dim, y dim)
            \draw[black, very thick, dashed] (0.5, 0.95) rectangle (1.25, 1.25);
            \coordinate (o1) at (0.5, 0.95);
            %\node at (p1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o2) at (0.5, 0.95+1.25/2);
            %\node at (p2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o3) at (0.5+1.25/2+0.1, 0.95);
            %\node at (p3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o4) at (0.5+1.25/2+0.1, 0.95+1.25/2);
            %\node at (p4) [draw=black, very thick, circle, scale=0.3] {};

           
            % begynner i punkt (x, y) rectangle (x dim, y dim)
            \draw[black, very thick, dashed] (0.5, 0.95) rectangle (1.25, 1.6);
            \coordinate (z1) at (0.5, 0.95);
            %\node at (q1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (z2) at (0.5, 0.95+1.25/2);
            %\node at (q2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (z3) at (0.5+1.25/2+0.1, 0.95);
            %\node at (q3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (z4) at (0.5+1.25/2+0.1, 0.95+1.25/2);
            %\node at (q4) [draw=black, very thick, circle, scale=0.3] {};


            %\draw[black, very thick, dashed] (0.8, 0.45) rectangle (1.25, 1.6);
            \coordinate (x1) at (0.8, 0.45);
            %\node at (u1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (x2) at (0.8, 0.45+1.25/2);
            %\node at (u2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (x3) at (0.8+1.25/2+0.1, 0.45);
            %\node at (u3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (x4) at (0.8+1.25/2+0.1, 0.45+1.25/2);
            %\node at (u4) [draw=black, very thick, circle, scale=0.3] {};
            \draw[black,very thick, dashed]   (x1) -- (x3) -- (x4) -- (x2) --(x1);
        \end{scope} 

        \begin{scope}[
            yshift=-195,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = green, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \coordinate (h_input) at (2.1, 0);
            \coordinate (h_bl) at (0, 2.7);
            %\node at (h_bl) [fill=blue, circle, scale=0.5] {$s$};
        \end{scope} 
           
           \draw[thick](3, -5.7)node[scale=1.3]{Input Layer};
           \draw[thick](3.5, -3.2)node[scale=1.3]{Convolutional layer 1};
           \draw[thick](3.5, -0.7)node[scale=1.3]{Convolutional layer 2};
           \draw[thick](-4.6, -0.2)node[scale=1.3]{Feature};
           \draw[thick](-4.6, -1.1)node[scale=1.3]{$\vdots$};
           \draw[thick](-4.6, -3.6)node[scale=1.3]{$\vdots$};
           \draw[thick](-4.4, -5.5)node[scale=1.3]{Channels};
           
        \begin{scope}[
            yshift=-190,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = blue, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \draw[black, very thick] (0,0) rectangle (2.1, 2.7); % marking borders 

            \coordinate (s1) at (0, 0);
            \coordinate (s2) at (0, 2.7);
            \coordinate (s3) at (2.1, 0);
            \coordinate (s4) at (2.1, 2.7);

            \draw[black,very thick]   (s9) -- (s1);
            \draw[black,very thick]   (s10) -- (s2);
            \draw[black,very thick]   (s11) -- (s3);
            \draw[black,very thick]   (s12) -- (s4);
                        
            \coordinate (h_gr) at (0, 2.7);

            % begynner i punkt (x, y) rectangle (x dim, y dim)
            \draw[black, very thick, dashed] (0.5, 0.95) rectangle (1.25, 1.6);
            \coordinate (q1) at (0.5, 0.95);
            %\node at (q1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (q2) at (0.5, 0.95+1.25/2);
            %\node at (q2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (q3) at (0.5+1.25/2+0.1, 0.95);
            %\node at (q3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (q4) at (0.5+1.25/2+0.1, 0.95+1.25/2);
            %\node at (q4) [draw=black, very thick, circle, scale=0.3] {};

            %\draw[black, very thick, dashed] (0.8, 0.45) rectangle (1.25, 1.6);
            \coordinate (u1) at (0.8, 0.45);
            %\node at (u1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (u2) at (0.8, 0.45+1.25/2);
            %\node at (u2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (u3) at (0.8+1.25/2+0.1, 0.45);
            %\node at (u3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (u4) at (0.8+1.25/2+0.1, 0.45+1.25/2);
            %\node at (u4) [draw=black, very thick, circle, scale=0.3] {};

            \draw[black,very thick, dashed]   (u1) -- (u3) -- (u4) -- (u2) --(u1);

            % Draws horizontal lines completing the litle cube.
            \draw[black,very thick, dashed]   (q1) -- (z1);
            \draw[black,very thick, dashed]   (q2) -- (z2);
            \draw[black,very thick, dashed]   (q3) -- (z3);
            \draw[black,very thick, dashed]   (q4) -- (z4);
            
            % Draws horizontal lines completing the litle cube.
            \draw[black,very thick, dashed]   (u1) -- (x1);
            \draw[black,very thick, dashed]   (u2) -- (x2);
            \draw[black,very thick, dashed]   (u3) -- (x3);
            \draw[black,very thick, dashed]   (u4) -- (x4);
            
        \end{scope} 

        \draw[black, thick, ->](-4.2, -5.95)node[left, scale=1.3]{green} to (h_bl);
        \draw[thick, ->](-4.2, -6.15)node[left, scale=1.3]{red} to (h_re);
        \draw[thick, ->](-4.2, -5.75)node[left, scale=1.3]{blue} to (h_gr);
        %%%%%%%%%%%%%%%%%%%%%%%% END OF INPUT LAYER 


        \begin{scope}[
            yshift=-140, every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            % Draws the boundary boxes
            \draw[black, very thick] (0,0) rectangle (2.1, 2.7);
            \coordinate (e5) at (0, 0);
            \coordinate (e6) at (0, 2.7);
            \coordinate (e7) at (2.1, 0);
            \coordinate (e8) at (2.1, 2.7);


            % draw left cylinder
            \coordinate (f) at (0.7, 1.1);
            \node at (f) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (f1) at (0.7, 1.15);
            %\node at (f1) [draw=red, very thick, circle, scale=0.3] {};
            \coordinate (f2) at (0.7, 1.05);
            %\node at (f2) [draw=red, very thick, circle, scale=0.3] {};
            
            % Draws the other
            \coordinate (g) at (1.1, 0.85);
            \node at (g) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (g1) at (1.1, 0.95);
            \coordinate (g2) at (1.1, 0.8);
            
            % Drawing the smaller lower 
            \draw[black, very thick, dashed] (0.5, 0.65) rectangle (1.25, 1.25);
            \coordinate (o1) at (0.5, 0.65);
            %\node at (o1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o2) at (0.5, 0.65+1.25/2);
            %\node at (o2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o3) at (0.5+1.25/2+0.1, 0.65);
            %\node at (o3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (o4) at (0.5+1.25/2+0.1, 0.65+1.25/2);
            %\node at (o4) [draw=black, very thick, circle, scale=0.3] {};
  
        \end{scope} 
        
        \begin{scope}[
            yshift=-135,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
        \end{scope} 
    
        \begin{scope}[
            yshift=-130,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
        \end{scope} 
    

        \begin{scope}[
            yshift=-125, every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \coordinate (h) at (2.1, 0);
            %\node at (h) [fill=blue, circle, scale=0.5] {$s$};
        \end{scope} 
        
        \begin{scope}[
            yshift=-120,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
        \end{scope} 
    
        \begin{scope}[
            yshift=-115,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            
            % Connections to maps
            \coordinate (sec_map_L2) at (0, 2.7);
            %\node at (sec_map_L2) [fill=blue, circle, scale=0.5] {$s$};
            
        \end{scope} 
    
        \begin{scope}[
            yshift=-110,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
                    
            % Connections to maps
            \coordinate (sec_map_L1) at (0, 2.7);
            %\node at (sec_map_L1) [fill=blue, circle, scale=0.5] {$s$};
            
          \coordinate (e1) at (0, 0);
          \coordinate (e2) at (0, 2.7);
          \coordinate (e3) at (2.1, 0);
          \coordinate (e4) at (2.1, 2.7);

            \draw[black, very thick] (0,0) rectangle (2.1, 2.7); % draw boundaries
            % draws horizontal lines
            \draw[black,very thick]   (e5) -- (e1);
            \draw[black,very thick]   (e6) -- (e2);
            \draw[black,very thick]   (e7) -- (e3);
            \draw[black,very thick]   (e8) -- (e4);
            
            % begynner i punkt (x, y) rectangle (x dim, y dim)
            \draw[black, very thick, dashed] (0.5, 0.65) rectangle (1.25, 1.25);
            \coordinate (p1) at (0.5, 0.65);
            %\node at (p1) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (p2) at (0.5, 0.65+1.25/2);
            %\node at (p2) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (p3) at (0.5+1.25/2+0.1, 0.65);
            %\node at (p3) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (p4) at (0.5+1.25/2+0.1, 0.65+1.25/2);
            %\node at (p4) [draw=black, very thick, circle, scale=0.3] {};

            % Draws horizontal lines completing the litle cube.
            \draw[black,very thick, dashed]   (p1) -- (o1);
            \draw[black,very thick, dashed]   (p2) -- (o2);
            \draw[black,very thick, dashed]   (p3) -- (o3);
            \draw[black,very thick, dashed]   (p4) -- (o4);
            
            % draw one cylinder
            \coordinate (w) at (0.7, 1.1);
            \node at (w) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (w1) at (0.7, 1.15);
            %\node at (f1) [draw=red, very thick, circle, scale=0.3] {};
            \coordinate (w2) at (0.7, 1.05);
            %\node at (f2) [draw=red, very thick, circle, scale=0.3] {};
            
            % Draws the other
            \coordinate (r) at (1.1, 0.85);
            \node at (r) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (r1) at (1.1, 0.95);
            \coordinate (r2) at (1.1, 0.8);

            \draw[black, very thick, dashed]   (f1) -- (w1);
            \draw[black, very thick, dashed]   (f2) -- (w2);

            \draw[black, very thick, dashed]   (g1) -- (r1);
            \draw[black, very thick, dashed]   (g2) -- (r2);


            % Connnection between layers 
            \draw[black,very thick, dashed]   (q1) -- (f);
            \draw[black,very thick, dashed]   (q2) -- (f);
            \draw[black,very thick, dashed]   (q3) -- (f);
            \draw[black,very thick, dashed]   (q4) -- (f);
            
            % Connnection between layers 
            \draw[black,very thick, dashed]   (u1) -- (g);
            \draw[black,very thick, dashed]   (u2) -- (g);
            \draw[black,very thick, dashed]   (u3) -- (g);
            \draw[black,very thick, dashed]   (u4) -- (g);
            

        \end{scope} 
    
    
    
    
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%% CONVOLUTIONAL LAYER 2
        
        \begin{scope}[
            yshift=-50,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % drawing layer 
            \coordinate (h) at (2.1, 0);
            %\node at (h) [fill=blue, circle, scale=0.5] {$s$};
            
        \end{scope} 

        \begin{scope}[
            yshift=-55,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
        \end{scope} 
        
        \begin{scope}[
            yshift=-60,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
                      
            % The outer box
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \coordinate (a5) at (0, 0);
            \coordinate (a6) at (0, 2.7);
            \coordinate (a7) at (2.1, 0);
            \coordinate (a8) at (2.1, 2.7);
            \draw[black, very thick] (0,0) rectangle (2.1, 2.7); % draw boundaries
                    
            % The inner box
            \coordinate (h) at (1.1, 1.2); % this should be connected to the next layer
            \node at (h) [draw=black, very thick, circle, scale=0.3] {};
            \coordinate (h1) at (1.1, 1.25);
            \coordinate (h2) at (1.1, 1.15);
            
        \end{scope} 
    
            \begin{scope}[
            yshift=-45,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            
            \coordinate (sec_map) at (0, 2.7);
            %\node at (sec_map) [fill=blue, circle, scale=0.5] {$s$};
            
        \end{scope} 
        
        \begin{scope}[
            yshift=-40,every node/.append style={
            yslant=0.5,xslant=-1.3},yslant=0.5,xslant=-1.3
                      ]
            \draw[black, very thick, fill = gray, opacity = 0.2] (0,0) rectangle (2.1, 2.7); % marking borders 
            \coordinate (a1) at (0, 0);
            \coordinate (a2) at (0, 2.7);
            \coordinate (a3) at (2.1, 0);
            \coordinate (a4) at (2.1, 2.7);

            \draw[black, very thick] (0,0) rectangle (2.1, 2.7); % draw boundaries
            % draws horizontal lines
            \draw[black,very thick]   (a5) -- (a1);
            \draw[black,very thick]   (a6) -- (a2);
            \draw[black,very thick]   (a7) -- (a3);
            \draw[black,very thick]   (a8) -- (a4);
            
            % Draws the cylinder
            \coordinate (i) at (1.1, 1.2);
            \node at (i) [draw=black, very thick, circle, scale=0.3] {};
            \node[right of=i, node distance=0.5cm] (p) {P};
            
            \coordinate (i1) at (1.1, 1.25); % for lines
            \coordinate (i2) at (1.1, 1.15); % for lines
            
            % drawing lines
            \draw[black,very thick, dashed]   (i1) -- (h1);
            \draw[black,very thick, dashed]   (i2) -- (h2);

            % Draw the lines connecting the first and second layer.
            \draw[black,very thick, dashed]   (p1) -- (h);
            \draw[black,very thick, dashed]   (p2) -- (h);
            \draw[black,very thick, dashed]   (p3) -- (h);
            \draw[black,very thick, dashed]   (p4) -- (h);

            \coordinate (first_map) at (0, 2.7);
            %\node at (first_map) [fill=blue, circle, scale=0.5] {$s$};

        \end{scope} 
    
        \draw[thick, ->](-4.2, -0.5)node[left, scale=1.3]{Map 1} to (first_map);
        \draw[thick, ->](-4.2, -0.8)node[left, scale=1.3]{Map 2} to (sec_map);
     
        \draw[thick, ->](-4.2, -3)node[left, scale=1.3]{Map 1} to (sec_map_L1);
        \draw[thick, ->](-4.2, -3.3)node[left, scale=1.3]{Map 2} to (sec_map_L2);
    % signed distance
    \end{tikzpicture}    
    \caption[Receptive field of pixel in convolutional neural network trained on RGB-image.]{First two layers of a convolutional neural network trained on RGB-images. Each convolutional layer contains multiple filters, thus producing stack of feature maps. Each layer learn the representation of the previous layer. The trailing layer get this stack as input, producing activations based on all channels. For each layer it contains representations of the structures found in the previous layer. The filters are the weights trained to find useful structures. In each convolutional layer multiple of these filters are passed over the image. The dashed volumes illustrate the receptive fields of a pixel, ``P''. The receptive field of a node in the second layer is larger than the one in first, since a pixel inherant the receptive fields of the nodes in its receptive field. Inspired by Figure (13-6) in \cite{OReiley_book}.
    }
    \label{fig:conv_layers}
\end{figure} 