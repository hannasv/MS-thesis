\section{Dataset - European Cloud Cover }
%This chapter presents the developed methodology used in the compilation of the dataset. 
This section presents the developed algorithms necessary for the compilation of the dataset \acrfull{ecc}. It is pieced together from two sources, ERA5 reanalysis and \acrlong{msg} cloud mask.

Several candidate satellites were studied before arriving at the combination of datasets presented in this chapter. Spatiotemporal consistency and resolution were given high priority. The variable cloud mask is provided by many satellites, bringing valuable information in itself, but also for the retrieval of other variables restricted to cloud free conditions, such as humidity. The satellite product chosen for this project is the \acrfull{msg}. This satellite is in geostationary orbit, and has an exceptional temporal resolution, scans every 15min. Knowing that the average lifetime of a cloud is 60min or less, it seems like a reasonable choice (\cite{lohmann2016}, pp. 19). The finished dataset, described in detail below, is named \acrfull{ecc}.

\subsection{Domain}
The geographical domain has, for this project, been restricted to latitude, $\theta \in[30,50]$ and longitude $\phi \in [-15, 25]$. The resulting dimensions of the grid become $81\times161$ pixels. Figure \ref{fig:map} shows the domain included in this dataset. The domain covers central Europe and north Africa.
\begin{figure}[h]
    \centering
    \includegraphics[scale = 1.0]{python_figs/Domain.png}
    \caption[Map over domain.]{Map showing the domain in the projection available in \acrshort{ecc}.}
    \label{fig:map}
\end{figure}

\subsection{Physical basis of variable decision} \label{sec:ecc}
The overall goal is to investigate whether basic meteorological variables such as temperature, pressure and humidity are sufficient for prediction of cloud fractional cover with a reasonable accuracy. Cloud dynamics is far more complicated than what can be describes by these variables, as discussed in Section \ref{sec:cloud_in_climate_system}.
%What is believed to be a sufficiently accurate model is further explained in Chapter \ref{ch:computer_experiments}.
The condition describing what is ``sufficiently accurate'' is further explained in Chapter \ref{ch:computer_experiments}.
%Reasonable accuracy can mean so much and it is different based on the method of evaluation and the chosen metric. A parametrization can be evaluated in isolation or in the context of a \acrshort{esm}-model. 
%There are several options when determining what is sufficiently accurate, a method can be evaluated in isolation and in the context of a climate model. In isolation it should be better than a a benchmark (chosen by ??) and in the context of a climate model it would be reducing the spread of uncertainty related to the variable we are predicting. 

This project is a \textit{proof of concept study} aimed to demonstrate the feasibility of using \acrshort{ai} to parametize \acrshort{cfc}. Employing data driven learning to represent cloud physics and dynamics in its full complexity requires measurements from technologies not yet invented. If they did exist, the computational cost would be enormous, and even then there would be no guarantee that the model performance would be %\textcolor{red}{the?} 
state-of-the-art.
%Not feasible in the foreseeable future to incorporate all the effects of micro-physics at a sufficient accuracy. 

Macrophysics properties describes the cloud as a unit, using properties like base height, top height, thickness, fractional cover and regime (also known as type). Microphysical processes are all mechanisms involving the particles forming a cloud. Examples of properties used to quantify the microphysical state
%\textcolor{red}{Synes "making up" a cloud hørtes litt rart ut, men det er du som er skyeksperten. Ville vurdert en annen beskrivelse hvis du har}. Examples of these variable \textcolor{red}{I setningen før har du kalt det for microphysical processes som er alle mechanisms. ville da også vurdert å bruke det videre "Examples of these mechanisms/microphysiacal processes are...." og evt. " and is treated as variables in the model/study" eller noe lignende} 
are \acrshort{ccn} and droplet number concentrations (\cite{Grabowski2019ModelingBetter}). Precipitation formation and cloud optical thickness are affected by changes on a microphysical level. However, they are undeniably closely related to the macrophysical properties of the cloud. Imagine precipitation without a cloud fractional cover? 

Reliable estimates of large-scale variables are available from using reanalyse or other climate models. Restricting the focus to the macrophysical aspect of clouds  makes it reasonable to chose these as explanatory variables and thereby ensuring that it is possible to build usable application of this parameterization in the future.

%Focusing on the macrophysical aspect of clouds its is reasonable to chose large-scale variables \textcolor{red}{Rar setning. gir ingen mening å bruke "its". Mener du kanskje "Focusing on the macro-physical aspect of clouds, it is reasonable to chose large-scale variables,..."}, for which reliable estimates are available from using reanalyse or other climate models, thereby ensuring that it is possible to build usable application of this in the future. \textcolor{red}{ALTFOR lang setning. Hele avsnittet er en setning! }
%\textcolor{red}{Focusing on the macro-physical aspect of clouds, it is reasonable to chose large-scale variables. Because, reliable estimates are available from the use of reanalyse or other climate models. It then ensures that it is possible to build usable application of this (hva er this? the variables?) in the future.}
For this dataset, all variables are produced by ERA5. Some variables have been chosen because they are reliable and fundamental meteorological variables, e.g. temperature and surface pressure. Others because they are essential in cloud formation, e.g. specific and relative humidity. They are all retrieved from the surface or the closest pressure level (1000hPa). The following section gives a brief introduction to their role in cloud formation. %\textcolor{red}{(Nå er du midt i seksjonen, så føles litt rart at du kommer med dette her, men kan kanskje heller si at "the rest of the section gives a brief ...."}

From the weather maps on the news, low and high pressure systems might be familiar terms. Low pressure systems are often associated with precipitation, while high pressure systems are associated with nice weather. The earth is not equally heated due to the earths spherical geometry. Warmer air rises, generating a low pressure at the surface. As the air rises the temperature decreases. From Equation \eqref{eq:clausius_clapeyron} it can be shown that, colder air can retain less vapour, enhancing the rate at which saturation is achieved. Under supersaturated conditions some of the vapour condenses, generating cloud water, forming a cloud, and occasionally precipitation. Summer is often associated with convective motions generating cumulus type clouds. %Evaporation rates 
%In presence of water at the surface, evaporation rates are also higher in a warmer climate \textcolor{red}{eller ikke? Fordamping drives vel av forskjellen i luftfuktighet ved bakken og luften i tillegg til vind? SElv om det er veldig varmt, men høy luftfuktighet så vil du ha lite fordamping. Så drivkraften er ikke varme. Tror ligningen er noe som fordamping = (e-es)*u hvor e er vannmetning i lufta og es ved overflaten eller noe og u er vind (men dette er tatt ut av hukommelsen og jeg ville sjekket det i Dingman)}. \textcolor{red}{Ellers et veldig bra avsnitt! Tydelig og enkelt forklart på en bra måte}

In areas of lower pressure, the surrounding air will flow toward the low pressure centre to offset the pressure difference. Induced by earths rotation the Coriolis effect force winds of low pressure system to swirl counterclockwise north of the equator and clockwise south of the equator, causing an accumulation of air in the centre of low pressure system. Pushing it to higher altitudes in the atmosphere. A high pressure system exhibit the exact opposite behaviour, it swirls in the reverse direction, and the air flows from the centre. Diverging air masses cause sinking motions of parcels from higher in the atmosphere to fill the void. 
% air from higher in the atmosphere to sink and fill the space left.
% \textit{Air from higher in the atmosphere sinks down to fill the space left as air moves outward.} 
Winds transports the substances suspended in air, such as pollutants and humidity. 

The dataset includes both relative and specific humidity. Relative humidity is a measure of how much vapour the air contains, relative to how much it can hold at a certain temperature. At relative humidity of 1 the air is at its dew point, and for higher values clouds form, under such supersaturated conditions it is often referred to as \textbf{X}, and therefore it is common to limit the range of relative humidity to be between 0 and 1. However the variable is still a measure of the identical ratio, and this explains why values exceeding 1 is present in the dataset. Relative humidity is unitless and for higher values the air is more humid.

Specific humidity is the ratio between mass of vapour and mass of air, with unit of $kg kg^{-1}$ (\cite{lohmann2016}, pp. 53-54). Whether relative or specific humidity is the better predictor is not clear a priori. The data is gathered from the model level closest to the surface, at an altitude of 1000hPa (\cite{lohmann2016}, pp. 81-84). \textbf{Les sidene igjen. Siteringen er nok på feil plass...}

\subsection{Area Weighting Regridding Scheme (AWRS)} \label{sec:remapping}
Computing cloud fractions based on cloud mask requires a regridding scheme. Common schemes for solving similar tasks are mean, nearest neighbour or area weighting. For this particular task, the pixels are of uneven size and the area weighted scheme seemed most appropriate. 

This section provides a step-by-step description of the necessary data processing done for the compilation of \acrshort{ecc}, transforming clouds masks provided in \textit{space-view} to cloud fractions on a uniform grid. \acrshort{eumetsat} doesn't provide suitable software to tackle this particular task (personal communication EUMETSAT staff). Building the dataset requires the implementations of software with functionality to perform the regridding, described in detail below, named the \acrfull{awrs}.

The regridding algorithm consist of two modules; \textit{(1) detection} and \textit{(2) area weighting algorithmn}. Let the subscripts denote the dataset pertaining to a particular grid. Grid\textsubscript{MSG} refers to the space-view grid of the \acrlong{msg} and grid\textsubscript{ECC} refers to the uniform grid originating from ERA5. Note that grid\textsubscript{ECC} is identical to  grid\textsubscript{ERA5}. The \textit{detection algorithmn}, determines the contributing pixel from grid\textsubscript{MSG} 
to the particular cells in the other coordinate system,
grid\textsubscript{ERA5} 
and their classification into the different categories such as \textit{corner}, \textit{centre}, \textit{left}, \textit{right}, \textit{upper} and \textit{lower boundary}. These categories are later used to isolate the portion of the pixel contributing to grid\textsubscript{ECC}.
%This is necessary to compute the area of the overlapping pixels. 
%\textbf{Include somewhere? In order to compute the area of the boundary pixels, their centre need to be rectified to the centre of the subsection that fall within the boundaries of grid\textsubscript{ECC}, and the pixel extent need to be updated.}
The second module, \textit{the area weighting}, consist of the category based area weighting algorithm based on the developed equations.

\subsubsection{Equations describing grid area}
Based on the assumptions  of a spherical earth the pixels areas are computed using spherical coordinates. Figure \ref{fig:spherical_coords} shows a square projected on to a sphere. Deriving the equation for computing the area of a square in spherical coordinates, requires integrating over changes in latitude, $d\theta$ and longitude, $d\phi$. In Equation \eqref{eq:sphere_integral} the variables of integration is given a prime to keep them distinct from the integration boundaries.
\input{ChapterX_Results_and_Conclusion/dataset/figurs/spherical_coord}
The general expression for the area of a square in spherical coordinates, is given by the following integral,
\begin{equation} \label{eq:sphere_integral}
    A = R^2\int_{ \theta - \delta \theta }^{\theta + \delta \theta} \int_{ \phi - \delta \phi }^{\phi + \delta \phi} cos\left( \theta' \right) d\phi' d\theta'
\end{equation}
%This can be rewriting into, \textbf{needs indices $(i, j)$ ..?}
the equation can be rewritten into,
\begin{equation} \label{eq:sphere_finish}
    A \left( \theta, \phi, \delta \theta, \delta \phi   \right)= 2R^2 \left( sin\left( \theta + \delta \theta  \right) - sin\left(  \theta - \delta \theta  \right) \right) \delta \phi
\end{equation}
where $R=6378km$ denotes the distance to earths centre, $\theta$ the latitude and $\phi$ the longitude. Relating Equations \eqref{eq:sphere_integral} and \eqref{eq:sphere_finish} to Figure \ref{fig:spherical_coords} by setting $d \theta = 2 \delta \theta$ and $d \phi = 2 \delta \phi$. The implementation is scaled by $R$.

The equations used to compute the area weighted cloud fractional cover is as follows,
\begin{equation} \label{eq:area_weighting}
    CFC_{ECC} = \frac{1}{A} \sum_{i=0}^{N} a_i m_i
\end{equation}
where,
\begin{equation} \label{eq:tot_area}
    A = \sum_{i=0}^{N} a_i
\end{equation}
Inserting $m_i = 1$ $\forall$ $i \in [0,N]$ into Equation \eqref{eq:area_weighting} results in $CFC_{ECC}=1$, independent of $a_i$, proving that the minor overlap between pixels in Figure \ref{fig:pixels_contributing_to_cell} doesn't affect the range of cloud fractions, which remains between 0 and 1.

\subsubsection{Estimating properties of grid\textsubscript{MSG}}
% Estimating the extent of the cell.
The coordinate information is provided in grids of latitudes, $\theta$ (degrees north), and longitudes, $\phi$ (degrees east) values. The coordinate represent the centre of a pixel. To acquire the information about the extent of cells in a non-uniform grid require some simplifications. 

%%%%%%%%%%%%% PART ONE
Computing the area weighted average of cloud masks requires detecting the grid\textsubscript{MSG}
contributing to the grid\textsubscript{ERA5} cell, and computing their area. The pixels are classified into five categories; \textit{centre}, \textit{left}, \textit{right}, \textit{up} and \textit{down boundary}.
%The detection algorithm is straight forward, overlapping pixels are included and labelled with a suitable category.
The cloud mask pixels are smallest at the nadir point, decreasing in all directions. Figure \ref{fig:estimate_dlon} illustrates this by showing an example of three neighbouring pixels. In this example the apparent pixel size increases going eastward. Consequently, there is an asymmetry between neighbouring pixels. The distance from the centre to the right and left neighbour is unequal. In order to take advantage of the analytical expression derived in Equation \eqref{eq:sphere_finish}, the extent of a contributing pixel is approximated by averaging the right and left distances. The categorisation is illustrated in Figure \ref{fig:pixels_contributing_to_cell} using different colours.
\input{ChapterX_Results_and_Conclusion/dataset/figurs/estimating_changes_in_longitude}
\begin{figure}
    \centering
    \includegraphics{python_figs/example_remapping_lat45_lon25.pdf}
    \caption{Example showing the contributing pixels to the remapping of pixel $(25, 45)$. The pixels from the satellite is classified into corner (grey), centre (pink), right (purple), left (yellow), down (green) and up (blue) boundary. The dense black line is the pixel in grid\textsubscript{ECC}, and the other pixels shows the contributing pixels from grid\textsubscript{MSG}.}
    \label{fig:pixels_contributing_to_cell}
\end{figure}

Approximation of $d\phi$ and $d\theta$ have been done based on the two-dimensional fields of latitude and longitude values according to the below equations.
Longitudinal values vary along the first dimension, denoted with index i. The estimated half the extent of a pixel in grid\textsubscript{MSG} is approximated by Equation \eqref{eq:app_lon}. Latitudinal changes are in north-south direction, along the second-axis, here denoted with index, j. Equation \eqref{eq:app_lat} describes the distance from the centre to the upper and lower boundary.
% \eqref{eq:app_lon} and  \eqref{eq:app_lat}. 
%The horizontal extent of a pixel $(i,j)$ be determined by the the averaged distance between the longitude of neighbouring pixels. 
%, see Equation \eqref{eq:app_lon}. The same principles applies in the latitudinal direction, this version is shown in Equation \ref{eq:app_lat}.
\begin{equation} \label{eq:app_lon}
    \delta \phi_{i,j} = \left| \frac{\phi_{i+1,j} - \phi_{i-1, j}}{4} \right|
\end{equation}
\begin{equation} \label{eq:app_lat}
    \delta \theta_{i,j} = \left| \frac{\theta_{i,j+1} - \theta_{i, j-1}}{4} \right|
\end{equation}

The ``square'' in grid\textsubscript{MSG} resembles a trapezium, as illustrated in Figure \ref{fig:estimate_dlon}. As far as the author know, it doesn't exist an analytical solution to an area of a trapezium in spherical coordinates. Also, it is not clear if approximating the area with another numerical method would reduce the overall uncertainty. However, it would most likely increase the computational time. 
A visual inspection of the relation between both grids is provided in 
Figure \ref{fig:pixels_contributing_to_cell}. Based on the small overlapping areas, it appears to be a reasonable simplification at the latitudes and longitudes of interest. This particular pixel was chosen since the largest overlap is expected in the periphery of grid\textsubscript{ECC}. The inclusion of the boundary pixels involve estimating the ``new'' centre and the extent of the contributing portion. Defined as the subset falling within the boundaries of grid\textsubscript{ECC}. Due to the small overlap between contribution pixel, occasionally more than four pixels are classified as corners. For the sake of simplicity the corner pixels where omitted from the calculations of cloud fraction. This may have caused the circular pattern shown in Figure \ref{fig:area_pixel_signal}. The areas decrease poleward, as illustrated in Figure \ref{fig:relative_size_neigbouring_pixels}. This again have most likely enlarged the radius of the circular pattern.
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/signal_area_pixel.pdf}
    \caption{Pixel areas decreasing poleward, also the pattern appear to be more pronounced close to the meridian decreasing in both east and west direction.}
    \label{fig:area_pixel_signal}
\end{figure} 

\input{ChapterX_Results_and_Conclusion/dataset/figurs/estimating_changes_lat_lon}

\subsection{Verification of AWRS}
The regridding scheme is a set of algorithms. Before the production of the full dataset it is important verify the correctness the algorithms of \acrshort{awrs}.

%%%%%%%%%%%%%%%%%%%%%% TEST 1 - Formula to compute the area 
The computations of the areas are the foundation of the \acrshort{awrs}, and it it crucial to verify that the algorithm is correct. CDO (\cite{cdo}) provide functionality to compute gridarea of a uniform grid using the code inserted below.
\begin{verbatim}
$ cdo gridarea era5data.nc gridarea.nc     
\end{verbatim}
To verify the implementations of Equation \eqref{eq:sphere_finish}, the grid areas of ERA5 is computed using both CDO and the self implemented algorithm. Both versions produce the same results.
% må jeg skrive hvor like 
Emphazising that the self implemented code is scaled by $R$ to be consistent CDO. Multiplication followed by division of the same number provides no additional information, and there is the off chance of introducing additional numerical errors. 

%%%%%%%%%%%%%%%%% TEST 2 -- vis regridding
A reason of confusion in the process of developing the algorithm of the \acrshort{awrs} algorithm arose from the different rotations of the data provided by the \acrshort{grib} and \acrshort{netcdf} files. The coordinate information is availble in \acrshort{netcdf}, but the file-size is to large to store all data in this format, therefore the data is downloaded in \acrshort{grib}, as mention in Section \ref{sec:EUMETSAT_cloud_mask}. The \acrshort{grib}-file is provided as the left and right flipped version of the  \acrshort{netcdf}-file. A fast modular test to check the regridding routine is to insert the raw data including the land and sea masks. Figure \ref{fig:visual_inspection_regridding} shows a example of the regridding of the raw data from 2\textsuperscript{nd} May 2009. Clouds are illustrated in white, land mask in teal and ocean in purple. The original data also include the category off-earth disk, this is not a member of the chosen subset. By regridded the raw data it quickly becomes apparent whether correct domain has been used, and evident if the algorithm generates any discontinuities in space. 
\begin{figure}
    \centering
    \includegraphics{python_figs/visual_regridding.pdf}
    \caption{Result from regridding raw data, provided with land and sea masks in the absence of clouds. Land is illustrated in teal, ocean in purple and clouds in white.}
    \label{fig:visual_inspection_regridding}
\end{figure}

\subsection{Missing Data} \label{sec:missing_values}
Missing values is inevitable when working with observational data. Sensors fail to collect measurements and data is missing. This can either be individual pixels or entire disks. In this project single NaN values are no pressing issue since they are remapped to fractions by using the area weighted of the other values. Contributing NaN pixels are counted and stored for future use in \acrshort{ecc}.
\begin{figure}
    \centering
    \includegraphics[scale = 1.0]{python_figs/heatmap_missing_values.pdf}
    \caption{Heatmap summarising missing hours per month for all years.}
    \label{fig:heatmap_missing_values}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[scale = 1.0]{python_figs/heatmap_missing_values_monthly_sum.pdf}
    \caption{Barplot showing the monthly sum of missing values. This excludes the contribution from the period of 2004 before the satellite was operational.}
    \label{fig:barplot_missing_values}
\end{figure}
In some cases the sensor fail to scan and in other cases the data has been destroyed prior to archiving. Independant of the cause, the result is the same, the data can never be recovered. %Further down the chain of supply, the missing data can cause issues for the process of downloading. Consequently, the requested data has entered infinity loop without being detected by \acrshort{eumetsat}. In combination with 
The maximum limit of pending request restricted to 20 have caused some delay. The data in each request amount to approximately 3.5 months of hourly data. 

Missing timestamps results in missing disks. When available the closest time step within the previous and trailing 45 minutes is used to fill the gap. A summary of missing values per month in the data set is provided in Figure \ref{fig:heatmap_missing_values}. Aggregation of missing values per month is presented in Figure \ref{fig:barplot_missing_values}. The plot is ment to illustrate any seasonal biases. The months of 2004 prior to the operalization of the satellite is not included as missing values.

METeosat provide a two satellite system, occasionally both standby and the operational scan at the same time, as mentioned in Section \ref{sec:meteosat}.
%To reduce the perturbations due to parallax (see Section X) of cloud, given a choice the operational satellite is chosen \textcolor{red}{(skjønte ikke setningen)}. 
In cases of technical failures, the standby scan is used. The scans are done from a different nominal position. However, the coordinate systems remain the same, since the standby scan is rectified to the position of the operational satellite before the product is released (personal communication \acrshort{eumetsat} staff). Comparing simultaneous measurements for the operational and the standby METeosat satellites, it becomes clear that they are disimilar. However, this doesn't occur to frequently and there has been no effort in quantifying the magnitude of the parallax, to correcting for for the bias it may introduce.
% again you have no numbers on the times the standby satellite is used.... 

Manually generated datasets are prone to human error, especially in the case where user need to download individual time steps to fill the gaps. The missing values was were double checked, but there is no guarantee that a few additional time steps is available. In summary the workflow has been as follows, the author downloaded the data, detect missing times and manually choose the closest time step available within the previous and trailing 45 minutes. In retrospect the, the downloading options (API or GUI) provided by the satellite service should be taken into account when choosing the data. A great API can potentially be a large time saver.

\subsection{Masks} \label{sec:mask}
The land sea masks are regridded from the HTAP-masks provided by \acrfull{metno}. In its original format the HTAP masks have a $0.1^o$ resolution and global coverage, not including the polar regions. These are regridded to a suitable resolution of $0.25^o$ using functionality available in PyAEROCOM (\cite{pyaerocom}). %(\href{https://pyaerocom.met.no/}{https://pyaerocom.met.no/}). 
This is a python toolbox developed within the \acrfull{aerocom} project. To avoid storing redundant data, only domain specific data is made available in the project supplementary repository. For more details on supplementary material, see Section \ref{sec:structure_and_implementations}.
%To keep memory-requirements to a minimum only the parts of the filters relevant domain is stored in the supplementary material for this project.
\begin{figure}
    \centering
    \includegraphics{python_figs/filters.pdf}
    \caption{Figure shows all filters, in white, available in the python package ``sciclouds''.}
    \label{fig:filters_subplot}
\end{figure}

Filters available in the supplementary material are \textit{land}, \textit{sea}, \textit{coastline} and \textit{artefact}. The coastline is defined to be all pixels that are not either 100\% land or sea. A threshold based binary classification is used to separate the coastline pixels into land or ocean. The threshold is set to 50\%. Pixels containing at least 50\% of sea is most likely affected by maritime conditions, making it reasonable to classify them as sea pixels.
\begin{figure}
    \centering
    \includegraphics{python_figs/example_artefact.pdf}
    \caption[Artefact in European Cloud Cover dataset.]{The results after regridding revels a artefact. This is a snapshot from May the second 2004 at noon. The frequency of occurrence is currently unknown.}
    \label{fig:example_artefact}
\end{figure}
Based on a visual comparison to Figure \ref{fig:example_artefact}, the artefact is defined to be all coastline pixels obeying the following inequality,  %\eqref{eq:artefact_condition}.
\begin{equation} \label{eq:artefact_condition}
    \theta + \frac{1}{3}\phi < 40
\end{equation}
All filters are displayed in Figure \ref{fig:filters_subplot}. 
%shows a subplot of all filters, including the artefact detecting filter. 
The signal form the artefact filter when applied to \acrshort{ecc} seem to follow a normal distribution as shown Figure \ref{fig:signal_artefact}. To get an idea of the frequency of appearance, it is necessary to detect when it appears in isolation and not in cloud. It could, for instance, be done by studying the histograms from the ratio of the artefact signal and a buffered artefact filter.
% Different approaches for detecting the artefact, separating the land, sea and coastline pixels. Filters to remove artefact in future. Can also use this compute statistics over land and ocean. Add land sea mask as subplot. 
No efforts have been made to remove the artefact from the data. %It is a thesis in itself %to remove the artefact 
%without introducing other complications like gaps in the dataset and or removing parts of an actual cloud.\textcolor{red}{Tenker det er unødvendig å ta med.... De skjønner at du har gjort mye jobb og at det er mye du kunne gjort, men ved å fortelle dem hvor mye jobb det er ved ulike oppgaver er ikke din oppgave her. Hold deg til problemstillingen din. }

\subsection{Statistical Properties in ECC}
To summarise and present the content of \acrshort{ecc} statistical properties are used. For clarity, the period used in this section is 2004 to 2018. The properties selected in this study is mean, minimum (min), maximum (max), median, \acrfull{std} and \acrfull{mad}. The most important results is presented in this section, and complementary figures can be found in the Appendix \ref{ch:appendix_statistic}. 
The data varies in space an time. Statistical properties are calculated over one or both these axis. %Determines the dimensions of the results. 
%\textbf{ Computing the statistical properties over one dimension, for instance time, leaves the spatial distribution of this property. Computing the statistics over space, leaves the temporal dimension. Computing the statistics over space and time leaves one value.} 

\subsubsection{Statistics over space and time}
%%% BAR PLOT GLOBAL STATISTICS
To study the statistical properties at different parts of the domain the filters, shown in Figure \ref{fig:filters_subplot}, were applied to the data before computing the statistical properties. Figure \ref{fig:bar_plot_global_stats} shows a barplot summarising the statistical properties for the five variables (Temperature, Surface Pressure, Cloud fractional cover, Specific and Relative humidity) and four filters (coast, land, sea and all). It shows minor differences between the statistical properties applied. The largest difference can be seen in the maximum value of relative humidity, where the maximum above land are larger than compared to ocean. The relative difference in magnitude between \acrshort{mad} and \acrshort{std} and the other variables from the reanalysis dataset, is solid. Most likely because the data is smoothed as a consequence of using assimilation model. 
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/bar_plot_global_statistics_new_legend.pdf}
    \caption{Bar plot showing global statistics for different filters.}
    \label{fig:bar_plot_global_stats}
\end{figure}

\subsubsection{Temporal statistics}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% MONTHLY MEANS
Figure \ref{fig:monthly_mean_ts_vars} shows the spatially averaged monthly mean values for all values. Seasonal effects and differences between land and ocean is evident among all variables. For temperature and relative humidity, a more pronounced seasonal cycle over land, compared to ocean, is evident. The remaining variables appear to have a small shift towards higher values.
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/monthly_means.pdf}
    \caption{Spatially averaged monthly values. Filters are applied for land and sea.}
    \label{fig:monthly_mean_ts_vars}
\end{figure}

The spatially averaged time series for the first week of August in 2012 is shown in Figure \ref{fig:first_week_august_2012}. Illustrating the relative strength of the signal feed to the input sequence. As a reference, the signal over land and ocean is provided. All variables display diurnal variations. Because of the different intervals of the axes, the magnitude of the signal proves difficult to determine from such a plot. The surface pressure over land and ocean appear to be a scaling of the ``no filter''. A common factor for all variables is the position if the filters relevant to each other, ``sea'' > ``no filter'' > ``land''. In some cases the monthly average temperature over land is higher than over ocean.
%Surface pressure provide nearly constant values and doesn't appear to be a good predictor. If a model predicting the same value as the day before, it doesn't provide more information. \textcolor{red}{En model kan vel gi samme informasjon som dagen før så lenge observasjonene ikke endrer seg. Ser ikke ut som cloud fractional cover helle rikke endrer seg så mye eller temperaturen. Temperaturen endrer seg bare med ca. 5 grader og det er vel ikke spesielt mye? Men du vet best, ville bare reagert på at det kan være aksene som gjør at det ser ut som en stor forskjell uten at det nødvendigvis er det. }
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/spatially_averaged_one_week_from_2012-08-01.png}
    \caption{Spatially averaged time series from the first week of August 2012.}
    \label{fig:first_week_august_2012}
\end{figure}


\subsubsection{Temporal statistics}
All the statistical properties computed over time for the variable \acrshort{cfc} in \acrshort{ecc} is plotted in 
Figure \ref{fig:all_stats_tcc}. Similar figures for the remaining variables in the dataset is presented in Section \ref{sec:all_stats}. %in the Appendix \ref{ch:appendix_statistic}. 
With the exception of minimum and maximum value, the cloud cover is affect by the coastline. 
%% CLOUD FRACTIONAL COVER
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/all_stat_variable_tcc.pdf}
    \caption{Contour plot showing the local (pixel) statistics for cloud fractional cover.}
    \label{fig:all_stats_tcc}
\end{figure}

The mean values displayed in figure \ref{fig:all_stats_tcc}, show that on average the coastline have a lower cloud cover than the adjacent areas. This is supported by the bar plot, see Figure \ref{fig:bar_plot_global_stats}. 

From the minimum values of \acrshort{cfc} it becomes evident that there is another artefact present in the dataset. This pattern is most likely caused by the remapping routine. Figure \ref{fig:area_pixel_signal} shows the patterns of magnitude of the areas contributing to a pixel. One might expect all pixels to be without cloud cover for at least on hour over the period of 14 years, but this is not the case. The maximum value is as expected, one over the entire region, indicating that at some point every pixel is full of clouds. The standard deviation is higher over land, this is caused by larger variation in cloud cover in these regions. The median and \acrshort{mad} 
% Det er jo ikke rart for mad er medianen av en differanse.
show similar patterns, this is not suprising since \acrshort{mad} is short for \acrlong{mad}, where the lowest values are found along the coast.

\subsubsection{Correlation between cloud cover and environmental variables}
%%% CORRELATION
Correlation describes how strong a pair of variables are linearly related. A positive correlation tells you that an increase in one variable results in an increase in the other. A negative correlation describes the opposite connection, implying that an increase in one variable cause a decrease in the other.
\begin{figure}[ht]
    \centering
    \includegraphics{python_figs/correlation_figure.pdf}
    \caption{Contour plot showing the correlation coefficient between environmental variables and cloud fractional cover.}
    \label{fig:correlation_tcc_vs_envio}
\end{figure}

The linear correlation coefficient from pairs of cloud cover and environmental variables such as temperature, pressure, relative and specific humidity is shown in Figure \ref{fig:correlation_tcc_vs_envio}. Recall that all environmental variables is produced by reanalysis. Pink illustrates negative correlation while green illustrates a positive correlation. Note that different patterns emerge from all variables. %, implying that they could be useful as predictors. 

Over land relative humidity is dominated by positive correlation to cloud cover, some part of Africa and the ocean in eastern Mediterranean has a negative correlation. The image of the surface pressure is remarkable similar, they share a pattern, but have opposite signs. The negative sign seems reasonable, since high pressure is often caused by sinking motions in the atmosphere and clouds are formed by rising motions. 

Specific humidity shows a clear shift at longitudinal degree 10. The land area in the west are positively correlated while the eastern part are  negatively correlated. 

In most locations temperature is negatively correlated with cloud cover except in parts of the Alps, north coast of France and in north Africa. This seems reasonable since warmer air can retain more vapours.%, on the other hand this could enhance evaporation rate, making more vapour available for condensing onto particles. 

% Finished regriddidng files.
\subsection{Summary}
\acrshort{ecc} comprises of five variables; temperature, pressure, cloud fractional cover, relative and specific humidity. These are collected from two sources; ERA5 and EUMETSAT. The resolution available in ERA5 was preserved, while remapping the cloud mask to cloud fractions cover. 
% duplication
The final product consist of %the variables temperature, pressure, cloud fraction, specific humidity and relative humidity, available
hourly data on a $0.25^o$ uniform grid resolution in the period from April 2004 to December 2018. Cloud fractional cover (\acrshort{cfc}) is produced from area weighting cloud masks. The \acrshort{awrs} is described in Section \ref{sec:remapping}. The remaining variables are on their original format as provided by \acrfull{ecmwf}. A summary of the original sources of the dataset is given in Table \ref{tab:dataset_summary}. More details on ERA5 is available in Section \ref{sec:era5} and for the cloud mask in Section \ref{sec:EUMETSAT_cloud_mask}. 
\input{Chapter2_Theory/tables/table_transposed.tex}
%Fractional cloud cover is computed from the cloud mask product retrieved by the second generations METeosat satellites. You can read more about this data in section \ref{sec:meteosat}. For simplicity we will refer to this dataset as European Cloud Cover Dataset, ECC from now on. The visual comparison between raw satellite images and cloud amount seem to agree. The cloud fractional distribution also retain the same shape as ERA5 and MODIS 6.1 Terra in the period from 2004 to 2018. \textbf{kilde?}

%\textbf{Something is missing here -- a table?}

%\subsection{Licences and Downloading Data} \label{sec:downloading_data}
%Scripts for downloading the ERA5 data used in this thesis is available in the project GitHub on \href{https://github.com/hannasv/MS/tree/metos/downloading{\_}RA}{https://github.com/hannasv/MS/tree/metos/downloading{\_}RA}. However you will need to create a CDS-user. Follow the instructions on ECMWF homepages on \textit{how to download ERA5}. There are no scripts available for downloading METEOSAT data this is done using satellite retrievals at EUMETSATs Earth Observation Portal. Its freely available in hourly resolution. Scientist can apply for increased resolution up to 15min. Choose the cloud mask product in grb-format. By running \textbf{X - legg inn filnavn} you can generate your own files for regridding. The supplementary material only include the domain used in this thesis, because of GitHub has a maximum limit allowed for uploading. 
