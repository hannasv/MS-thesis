\setcounter{chapter}{1} 
\newacronym{esm}{ESM}{Earth system models}
\chapter{Theoretical Background } \label{ch:theoretical_back}
This chapter describes the background for this thesis work. First it describes clouds role in the climate system. Starting with cloud formation, including the clouds effect on radiative budget in the current climate and the suggestion of future cloud climatologies as proposed by \acrfull{ipcc} in assessment report 5. This is followed by a introduction to parametrization of clouds, the method used to incorporate clouds into models, therefore necessary in studies of cloud feedback's. %in future climates. 
Finally, the data used to compile the dataset is introduced. 

\input{Chapter2_Theory/clouds.tex}

\section{Parametrization of clouds} \label{sec:param_clouds}
\textbf{The development of both systems (observations and models) requires a understanding of the physical and biogeochemical processes that takes place in the earth system.
Developing models involve testing new conseptual ideas. A model is benchmarked against observation to ensure that it is capable of describing the desired mechanisms.} There is a considerable amount of different numerical models used in weather forecasting or climate research. The models used in the last assessment report from \acrshort{ipcc} is called \acrfull{cmip5}. This is a collaboration between 20 modelling groups world wide (\cite{Taylor2012AnDesign}, \cite{IPCC_CH9_climate_models}). 

This section will give a brief introduction to some methods used for parameterizing clouds. The aim is to give the reader an idea of earlier endeavours. Limited by computational power and knowledge of cloud processes, including all small scale processes described in previous sections is a impossible task. 

A common denominator between other parameterization is cloud type specific schemes. Its believed that focusing on fewer variables stands a better chanse of reducing the uncertainty associated with cloud processes. Building a model based on meteorological variables provided by a reliable estimate from reanalysis datasets. Employing a hierarchical modelling approach focusing on macrophysical properties. Macrophysics properties describes the cloud as a whole. Examples of such properties are base height, top height, thickness, fractional cover and regime/type. Microphysical processes are all mechanisms involving the particles making up a cloud. Examples of these variable are cloud condensation nuclei and droplet number concentrations. (\cite{Grabowski2019ModelingBetter}).

% https://journals.ametsoc.org/doi/pdf/10.1175/2009JAS3072.1
% https://www.esrl.noaa.gov/psd/iasoa/vocabulary/Cloud%20Properties/Macrophysical
Precipitation formation and cloud optical thickness is affected by changes on a microphysical level. However, they are undeniably closely related to the macrophysical properties of the cloud. Imagine precipitation without a cloud fractional cover. 

Due to small scale of the processes involved, modelling the effects of clouds on the earth system requires parameterizations. 
Due to the large uncertainty in \acrfull{ecs} related to clouds. This area has received a lot of attention the last few years. A consequence of increasing the complexity of the models is the trailing increase in uncertainty. Popular approaches are saturation threshold, \acrfull{pdf} and \acrfull{crm}. 

%The data driven approach taken in this thesis does not net this case-specific adjustment. Doesn't need different approaches for different regimes, but relies on the satellites capabilities to detect them. Cirrus being the most difficult. When you one as seperate parameterizations for different cloud regimens, a consequence of this is that the cloud fraction might exceed 1.

\subsection{Relative humidity schemes}
The simplest form of cloud scheme is a binary. A pixel is either cloudy of clear. Equation \eqref{eq:binary_param_clouds} describes a diagnostic relationship between cloud cover and relative humidity. Binary saturation threshold can be implemented as follows,
\begin{equation} \label{eq:binary_param_clouds}
    CLA\left(RH\right) = 
     \begin{cases}
       \text{0,} &\quad\text{if RH}\le100\\
       \text{1,} &\quad\text{else}
     \end{cases}
\end{equation}

\subsection{Statistical schemes}
Most climate models have a fractional cloud cover, which is driven by saturation threshold. All the vapour in excess of saturation, $RH=100\%$, gets turned into cloud liquid water. Sub-grid scale variability is necessary to achieve fractional cloud cover. The most common variables either alone or in combination is relative humidity, temperature and vertical velocity. 

Based on observations, from air plane campaigns, researches have attempted to draw statistical distributions of relevant variables and then implementing these \acrshort{pdf} into models. Virtually all existing \acrshort{pdf}s have been used to model either cloud cover or its dependant variables. % humidity, temperature and so on. 
A reproduction of the summary from \cite{Tompkins2009CloudParametrization}, describing distribution used in a selection of papers is given in table \ref{tab:summary_PDF}.
\input{Chapter2_Theory/tables/param_summary_tomkins}

Researchers have not been successful in finding a adequate representation of cloud cover using these approaches (\cite{Tompkins2009CloudParametrization}) \textbf{Dobbelsjekk at det står der}. \cite{Golaz2002_part1} derived a joint \acrshort{pdf} to parametrize boundary layer clouds. This is implemented in \acrfull{noresm} and \acrfull{cesm}, to recognized \acrshort{esm}. \textbf{citation ask Trude} 

%%%%%%%%%%%%% Beskriv Golaz sin parameterisering.
Their parameterization can be regarded as a higher order turbulent closure problem. A big advantage of this scheme is that the same scheme can be applied to all regimes. Developing general conditions to differentiate between different regimes. \textbf{Les mer ...}

Parameterizations based on dependant structures. (co-depandant on each other ) The results are available in \cite{Golaz2002_part2}.



%What is necessary to understand why clouds are Parameterisations. Cite that all climate models are wrong but some are useful.
\subsection{Cloud resolving models} \label{sec:params_climate_models}
\cite{raso}
One method to deal with this is cloud parameterisation are cloud resolving models. The name cloud resolving model implies that the scale is small enough to resolve a cloud, this is not the full truth. It runs a \acrlong{les} model, more of the smaller scale processes can be resolved. Parameterizing the microphysical scheme, while resolving the convective motions.
% turbulent and aerosols effects.

Including aerosols in models, involves parametzising its sources and sinks. Precipitation is the main cause of deposition of aerosols. Les om nedbør i \cite{Simmons2016Observation2016-2025}. 


Accelerating the computations using \acrshort{dl} methods to emmulated the models.  Emmulation in the contex of computing referes to, \textit{imitation of behavior of a computer or other electronic system with the help of another type of computer/system}. The \acrshort{dl} model is then restricted to perform at most as good as the \acrshort{crm} (\cite{Rasp2018DeepModels}).


%The contributions of the clouds to the short wave component in the radiative budget is the main contributor to the uncertainty. Short wave cloud feedback. \textit{To this day neither observations of \acrfull{gcm} provide clear evidence or contradict the low level clouds feedback}. There is no accepted basis to refuse a \acrshort{gcm} \textit{a priori} \textbf{this increases the multi-model mean spread in climate sensitivity}. Missing representations of clouds micro-physical processes related to opacity or cirrus (high altitude, composed of ice) clouds. \textbf{cite AR5}

%The computational cost of generating these large ensembles are limiting factor. Simplified models in terms of resolution and/ or complexity is common/often necessary. 

The proposed parameterization of clouds includes some considerable simplifications, neglecting cloud microphisics. 


\subsection{ERA5 - make sure this should be included before you write it} \label{sec:param_ERA5}
ERA5 is produced used IFS cycle 4lr2. This has a new cloud scheme or hydrological cycle. \textbf{Artikkelen forteller om oppdateringer fra sist era-interim produksjon ikke alt som finnes. Bedre å skrive denne etter du har skrevet i datasettet hvor }. Husk Tomkins jobber for ECMWF.

\textbf{Write this if you compare your clouds to era5 clouds.}

\section{Data}
\textbf{write introductions}


\subsection{ERA5} \label{sec:era5}
ERA5 is the latest in the series of reanalysis produced by \acrfull{ecmwf}. Re-analysis is as close to observations as one can get coherent in space and time. It is produced using a forecast model to assimilate observations. Data assimilation take observations and input and tries to make a accurate estimate of the state of the system. This includes observations from ground based, ships, bouyes, airplanes and satellites. The analysis is produced in the operational system, making it available within five days of real time. ERA5 is based on the Integrated Forecasting System, IFS cycle 4lr2. The data is available in $0.25^o$ degree and hourly resolution. Its an important product for the continuous climate monitoring of the earth system. 

Reanalyses data is often mistakenly referred to as observations. This was the theme of a essay in \acrfull{bams}, 2015 (\cite{Parker2016ReanalysesDifference}). Based on the following three points they conclude that observations and re-analysis are not to different. First, both involve inference (theory based calculations). Re-analysis relies on forecast and observations does not. Second, it is not a significant difference as long as the forecast is sufficiently accurate. Third, its important to be aware of that the uncertainty of the reanalysis is less well known than for observations. This makes it harder to judge appropriate use of the reanalysis. 

\textbf{In what section does the following belong.}
It can be worth noting that the all sky radiance's from \acrfull{msg} in the period 2003-2012 is included in the assimilation. This is the same satellite that provides the cloud mask. 
\textbf{One sentence explaining that we have judged the appropriate use and have come to the conclusion that using the assimilated variables and not parameterised are appropriate for this application.}

\subsection{Remote sensing of cloud properties}
Satellites are instruments capable of providing continuous global measurements. Two types of sensors, passive and active imagers. The passive imaging sensor detects natural occurring levels of radiation. Opposed to active sensor, which detect the radiation returned from a emitted artificially fixed pulse of radiation.
\input{Chapter2_Theory/subplot_satellite_channels}
\cite{Karlsson2015AdvancingData} list the five key properties for remote sensing of clouds using passive imagery. To have a reference figure \ref{fig:SEVIRI_channels} shows examples on how different properties are seen by the satellite. This includes the four spectral bands, WV 6.2, VIS 0.6, IR 3.9 and IR 10.8. In general anything that appears bright have a higher reflectance at the \acrfull{toa} than the surface. Lower radiences are displayed in darker colours and brighter is white. Clouds appear bright in VIS and NIR channels, see \ref{fig:VIS_0.6}. Clouds consisting of liquid droplets reflect strongly in SWIR and MWIR. This is shown in figure \ref{fig:IR_3.9}. The earth surface, including snow and ice, appear dark. This allows for detection of low level clouds at night. Exploiting the fact that clouds are not perfectly emitting black bodies. Cloud are typically colder than the earth surface. Cirrus cloud are optically thin, but can be detected using split window channels (IR10.8 and IR12.0) differences. See figure \ref{fig:IR_10.8}. Figure \ref{fig:WV_6.2} shows detected water vapour. In general broken clouds give rise to scattered pattern or texture in images otherwise homogeneous, ice-free ocean for instance. To summaries the success of a screening is dependant on the illumination, the state of the surface and atmosphere (\cite{Karlsson2015AdvancingData}).  The number of spectral bands and footprint size (pixel resolution) determine the practical application a particular retrieval can be used for. Differences in swath width determine the frequency at a given position. Viewing angle affect the optical properties of the medium (but also its apparent position). \textit{Parallax} describes the apparent shift in position of a object, when you move the observer along a axis. This is a issue in remote sensing. Positions of satellites are moved and high viewing angles may cause similar issues. Since the position of objects is relevant to the viewing angle. A high viewing angle may introduce problems with parallax of high clouds. This factor is negligible when detecting low clouds (\cite{Joro2010ComparisonFinland}). Moving the observer (satellite) changes the apparent position of the measurement. 

Differences in sensitivity and retrieval algorithms contribute to a large spread in global mean cloud amount among different cloud products. In their assessment of global cloud datasets \cite{Stubenrauch2013AssessmentPanel} compared the global mean cloud cover of six datasets (ISCCP, PATMOS-x, MODIS-ST, MODIS-CE, AIR-LMD and TOVS Path-B). In this process they eliminating MISR and ATSR-GRAPE because of different observation times (as in Table 3.) and two outlier datasets, HIRS-NOAA and POLDER. Their results show that the difference among the six datasets, the difference is of order 0.08. On the contrary, local differences could be up to 0.4. Its worth noting that the satellite data using in this thesis is not included in  \citeauthor{Stubenrauch2013AssessmentPanel} study, but its illustrates nicely the large differences among other datasets. 

%Cloud-Aerosol Lidar and Infrared Pathfinder Satellite Observations, CALISO is much used in other research because it gives a vertically resolved cloud (3D observations). This additional spatial information is provided on the expense of frequency and uncertainty. \textit{Reason why calipso is ruled out as a candidate. large uncertainty Stubenau} MODIS has low spatial resolution but high temporal resolution, one to two days. National Oceanic and Atmospheric Administration, NOAA \textbf{ something}. Most polar orbiting satellites have a resolution at best daily. \textbf{kilde (shubenau)} \textbf{Does the other one give ferdig produkter av skyfraksjoner og eller er mye lettere og regridde??} The number of channels (higher for other than METEOSAT). The more channels you have the more accurate cloud detection algorihms you can use. Most of the uncertainty in satellite retrivals are attributed to the presence of clouds.  

\textbf{Hugo how much where you thinking of including from other satellites.}

\subsection{METeosat Second Generation, MSG} \label{sec:meteosat}
Prior to the launch of the METeosat researchers discussed the temporal frequency suitable for the observing weather. The METeosat first generation had a temporal resolution of 30min \textbf{kilde}. For the second generation, 15min intervals was chosen to best cope with the short lifetime and rapid deformation of clouds. It was also suggested that a temporal frequency of 1 to 10min is necessary tracking cumulus type clouds. \textbf{kilde stubenau - må være en annen kilde}. This agrees with the table 1.3 in Lohmann et. al. stating the lifetimes of different type clouds. \textbf{kilde Lohmann s. 19} There is a \textit{ring} of geostationary satellites located at equator providing a global covering (not included polar regions). The altitude of satellite determine the forward velocity and is chosen for the geostationary orbit. To achieve this orbit it needs to maintain a height of $\sim 36 000km $. The first Meteosat Second Generation (MSG-1) was lauched 28 August 2002. It became operational 29 January 2004 and got renamed Meteosat-8. The \acrshort{msg} system provides a two satellite system, one operational and one standby. This introduces issues related to the parallax. It becomes evident when comparing simultaneous measurements for the operation and the standby METeosat satellites. \ref{tab:dataset_summary} The operational satellite at a nadir point of $0^o$ latitude. Samples a full disk in cycles of 15min. A full disk is $3712\times 3712$ pixels.
%\textbf{Thoughts:}
%\begin{enumerate}
%    \item Would it be possible to see further north if the altitude where higher? (Wouldn't be geostationary anymore but would you.)
%    \item Må den alltid være på latitude = 0 for å være geostationary? 
%\end{enumerate}
%METeosat is the only geostationary satellite covering the Europe, Africa and India?. Geostationary \textit{ring} of GEO-satellites. 
The \acrfull{msg} was established as a corporation between \acrfull{esa} and \acrfull{eumetsat}. \acrshort{esa} was in charge of developing the prototype of MSG-1. \acrshort{eumetsat} is responsible for maintaining the user requirements, launch procedures, developing ground segments, ensuring over all system consistency and day to day operations.  \acrshort{msg} primary function is to provide a continuous observations of the earths full disk. Near-constant sampling frequency and a geostationary orbit allows for observing weather phenomena occurring on short scales. Since the satellite always is located at $0^o$ the spatial resolution is not constant spatial resolution, unlike the polar orbiting satellites. The resolution becomes coarser with increasing off-nadir viewing angle (\cite{Stubenrauch2013AssessmentPanel}). There are efforts invested in extending the MSG dataset with the MFG, in order to make use of the time series all the way back to 1980. \textbf{kilde, launched 1977} This is requires new cloud detection algorithms since they only have three common channels and two of them are useful for detecting clouds. \textbf{kilde Stöckli} This could potentially be useful in the future. 

On board the \acrshort{msg} is the \acrfull{seviri} imaging radiometer. Its has  12 spectral channels. The scan is done south to north, east to west. The wavelength of the discrete channels are chosen based on heritage from other sensors. One broadband visible channel, three solar channels (0.6, 0.8 and 1.6 $\mu m$) and 8 thermal infrared channels (3.9, 6.2, 7.3, 8.7, 9.7, 10.8, 12.0 and 13.4 $\mu m$) (\cite{Taravat2015MultilayerMasking}). (Taravat, 2015)  This is of great advantage since much of the community already know how to use the \acrshort{seviri} radiance observations. The channels have been chosen based on their ability to detect clouds, water vapour and ozone. More information about what the different channels detect is available in this paper \textit{An introduction to METeosat second generation (MSG)} published in BAMS 2002 (\cite{Schmetz_meteosat_intro}). % \ref{tab:dataset_summary}. 
\begin{figure}[h]
    \centering
    \includegraphics[scale=0.11]{Chapter2_Theory/images/MET10_RGBNatColourEnhncd_FullResolution_20191123120000.jpg}    
    \caption{\textit{Coverage with \acrshort{seviri} on MSG.}The view of the earth from \acrshort{msg}. The picture is dated noon on the 11 November 2019. \textbf{Cite EUMETSAT}. By studying the patterns it becomes evident that clouds are influenced by the circulations. The image is "Natural colors enhanced"}
    \label{fig:sat_view}
\end{figure}
%You may calculate the difference of the measurements, e.g. for channels VIS0.6, IR3.9 and IR10.8 between the two satellites. This will give an estimate how large the measurements differ and as a consequence the products (e.g. cloud mask) will be different.\textbf{also personal correspondance.}
The operational cloud detection algorithm is pixel by pixel. Post processing involves re-classifing isolated pixels. There is a lot of effort invested in new detection algorithms including spatial structures. One of the methods that show potential here is deep learning \textbf{List many sources.}

The viewing angle attributes to small differences in detected cloud mask. Explained by parallax. This becomes evident when the standby and operational satellite scan simultaneously. By default the standby satellite is adjusted to fit the position of the operational. By taking the difference some small patterns becomes visible. This is not accounted/adjusted for when using the data. Sometimes both satellites gather data at the same time. Then the standby-satellite grid is rectified to a a grid of the operational one \textbf{(Personal correspondence EUMETSAT staff).} 

\subsection{EUMETSAT Cloud Mask} \label{sec:EUMETSAT_cloud_mask}

The \acrshort{eumetsat} cloud mask, CLM consist of four classes, described in table \ref{tab:classes_clm}.

\input{Chapter2_Theory/tables/description_EUMETSAT_cloud_mask}
\input{Chapter2_Theory/tables/msg_spectral_bands}

These classes are derived from almost all channels except HRV and isolated pixels are reclassified \textbf{cite article 10 in Tavarat, 2015}. The cloud mask is distributed in GRIdded Binary or General Regularly-distributed Information in Binary form (GRIB) (no coordinates) and network Common Data Form (NetCDF) (coordinates). The data is available on Earth Observation Portal on EUMETSATS web pages. 

%\begin{figure}[h]
%    \centering
%    \includegraphics[scale = 0.6]{Chapter2_Theory/images/coordinates.png}
%    \caption{Credit, https://tex.stackexchange.com/questions/159445/draw-in-cylindrical-and-spherical-coordinates}
%    \label{fig:coords}
%\end{figure}
%The cloud cover will be referred to as cloud amount, fraction or simply the clouds.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{Chapter2_Theory/practical_implications.tex}

\subsubsection{summary}
This thesis aim to devolop and/or explore methods of parameterising cloud cover based on macro-scale variables like humidity, surface temperature and pressure. Regressing historical observations against macro physical properties which affect clouds. Moving away from the subgrid scale processes. Wish to answar weather there be enough information in humidity, temperature and surface pressure to predict clouds in a time and space.



% Kommentarer fra Hugo om skriving : Teoridelem om satelitter hva er nevn flere og deres oppløsning og hva er fordelen og ulemepen med dem. 
%  Legg inn helt generelle ting i teoretical background åså diskuter selve datasettet i metoden.

% Ignorer artifakten men kommenter i resultatene, keep in mind the artifact is present. 
% Fixed input length, normally one would add 0 if it not present. We need to find a value to add. 
% Scaling is smart due to numerical error not necessarily a requirement for the statistical models. 
% Missing values can be dealt with in two ways. 
% 1) Calculate the average ()
% 2) Predict the missing values - as always this might lead to a unnatural smoothness. 
% 3) 